const replaceHtmlEntites=function(){var t=/&(nbsp|amp|quot|lt|gt);/g,e={nbsp:String.fromCharCode(160),amp:"&",quot:'"',lt:"<",gt:">"},n=function(t,n){return e[n]};return function(e){return e.replace(t,n)}}();Object.prototype.do=function(t){return t.call(this),this};class UV{constructor(){this.uvRenderer,this.components=[]}createRenderer(){return this.uvRenderer=new UVRenderer}async add(...t){this.components.push(...t)}async define(...t){t.forEach(async t=>{const e=(this.uvRenderer||this.createRenderer()).render(t),n=UVComponent.from(e);this.add(n)})}async defineFromMUVFile(t,e){const n=await fetch(e).then(t=>t.text());this.defineFromMUV(t,n)}async defineFromMUV(t,e){const n=(this.uvRenderer||this.createRenderer()).renderText(t,window.atob(e)),r=UVComponent.from(n);this.components.push(r)}render(){document.head.appendChild(document.createElement("style").do(function(){this.innerHTML+='\n@import url("https://raw.githubusercontent.com/UV-mod/source/main/uvcondo/uvcondo.css")\n\t\t\t\t'})),this.components.forEach(async _comp=>{const component=await _comp,html=component.shadow,componentName="uv-"+component.id;window.customElements.define(componentName,class extends HTMLElement{constructor(){super(),this.shadow=void 0,0!=html.children.length&&(this.shadow=this.attachShadow({mode:"open"})),this.css=document.createElement("style"),this.css.innerHTML+=replaceHtmlEntites(component.style.innerHTML),(this.shadow||window.document.head).appendChild(this.css),void 0!=this.shadow&&(this.shadow.innerHTML+=html.innerHTML.replace(/\$text/gm,this.innerHTML).trim(),this.innerHTML=""),this.startScript=eval(`(function(multiMethod, parentElement){${replaceHtmlEntites(component.script.innerHTML)}})`)}connectedCallback(){this.startScript.call(this.shadow||this,{adaptiveColor:function(t,e="#000000",n="#ffffff"){var r=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/),s=r[0],o=r[1],i=r[2];return Math.sqrt(s*s+o*o+i*i)>128?e:n}},this.parentElement)}disconnectedCallback(){}static get observedAttributes(){return[]}attributeChangedCallback(t,e,n){}adoptedCallback(){}})})}}class UVRenderer{constructor(){this.domParser=new DOMParser}async render(t){const e=await fetch(t).then(t=>t.text());return this.domParser.parseFromString(`<component id="${t.split(/[\/\\]/g).at(-1).split(".").at(0)}">${e}</component>`.replace(/&/gm,"&amp;"),"application/xml")}async renderText(t,e){return this.domParser.parseFromString(`<component id="${await t}">${await e}</component>`.replace(/&/gm,"&amp;"),"application/xml")}}class UVComponent{constructor(){this.id=void 0,this.shadow=void 0,this.style=void 0,this.script=void 0,this.element=void 0}static async from(t){var e=new UVComponent;const n=(await t).documentElement;return e.element=n,e.id=n.getAttribute("id"),e.shadow=n.getElementsByTagName("shadow")[0],e.style=n.getElementsByTagName("style")[0],e.script=n.getElementsByTagName("script")[0],e}static renderCSS(t){const e=[...t.matchAll(/\s*(.*)\s*\{\s*([^{}]*)\s*\}/gm)];if(e.some(t=>3!=t.length))throw new Error("Length error");return e.map(t=>({selector:t.at(1).trim(),value:t.at(2).trim().replace(/[\r\n\t]/gm,"").split(";").map(t=>t.split(":").map(t=>t.trim())).filter(t=>t.some(t=>""!=t))}))}}export default{UV:UV,UVRenderer:UVRenderer,UVComponent:UVComponent};export{UV,UVRenderer,UVComponent};(window||globalThis).uv=new UV;